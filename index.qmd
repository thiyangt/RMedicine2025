---
title: "Dengue Forecasting Addressing the Interrupted Effect from COVID-19 Cases"
subtitle: ""
author:
  - name: "Thiyanga S. Talagala"
    affiliation:
      - "University of Sri Jayewardenepura, Sri Lanka"
date: last-modified
date-format: "MMMM D, YYYY"
format:
  revealjs:
    theme: 
      - default
      - slides.scss
    title-slide-attributes:
      data-background-image: "img/rmed_background.png"
      data-background-size: cover
      data-background-opacity: "50"
    fontsize: 2em
    html-math-method: mathjax
    slide-number: c/t
    show-slide-number: all
    highlight-style: rstudio_default-light.theme
    logo: "img/rmed.png"
   # footer: "[Slides are here](https://){target='_blank'}"  # complete the URL
    include-after-body: "img/clean_title_page.html"
include-in-header:
  text: |
    <link rel="shortcut icon" href="img/rmed.ico"/>
embed-resources: true
knitr:
  opts_chunk:      ########## set global options ############
    collapse: true # keep code from blocks together (if shown)
    echo: false    # don't show code
    message: true  # show messages
    warning: true  # show warnings
    error: true    # show error messages
    comment: ""    # don't show ## with printed output
    R.options:   
      digits: 3    # round to three digits
editor_options:
  chunk_output_type: console
editor: source
highlight-style: rstudio_default-light.theme
---


# **Mosquitoes** or **Snakes** â€” \newline which scares you more?
 
```{r echo=FALSE}
# Helper packages - need dplyr and ggplot
library(conflicted)
suppressPackageStartupMessages(library(tidymodels))
tidymodels_prefer()
 
suppressPackageStartupMessages(library(tidyverse))

library(knitr)
# library(kableExtra)
```
 


## Countries with Risk of Dengue

(Based on 2019 data)

```{r, warning=FALSE, message=FALSE}
library(denguedatahub)
library(ggplot2)
library(maps)
library(magrittr)
library(viridis)

# Filter for the year 2019
worlddata2019 <- dplyr::filter(world_annual, year == 2019)

# Enhanced plot with caption
ggplot(worlddata2019, aes(x = long, y = lat, group = group, fill = factor(dengue.present))) +
  geom_polygon(color = "black") +
  coord_fixed(1.3) +  # Ensures correct aspect ratio
  scale_fill_manual(values=c( "#969696", "#fc9272"),name = "Dengue Presence", labels = c("No", "Yes")) +  # Using viridis for better color representation
  labs(
 #   title = "Global Dengue Distribution in 2019",
 #   subtitle = "Presence of Dengue Virus Reported by Country",
    x = "Longitude",
    y = "Latitude",
    caption = "Author: Thiyanga S. Talagala, Source: https://denguedatahub.netlify.app/world.html"  # Adding caption
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 12)
  )

```

## Why are countries near the equator at higher risk of dengue?"

:::: {.columns}

::: {.column width="50%"}

```{r}
knitr::include_graphics("presentationimage/mosquito-life-cycle-illustration.jpg")
```



<span style="font-size: xx-small;">Image Source: [https://www.gptx.org/Departments/Public-Health-and-Environmental-Quality/Public-Health/Mosquito-Control-Fight-the-Bite/Mosquito-Facts](https://www.gptx.org/Departments/Public-Health-and-Environmental-Quality/Public-Health/Mosquito-Control-Fight-the-Bite/Mosquito-Facts)</span>


:::

::: {.column width="50%"}

**Favorable climate that speed up the mosquito life cycle**

1. Warm temperatures year-round

2. High humidity and frequent rainfall

3. No harsh winters

4. Many equatorial countries have rapidly growing urban areas with poor waste and water management.

5. People often live and work in open environments with limited protection, increasing exposure.



:::

::::

## Countries with Risk of Dengue

Sri Lanka

```{r, out.height="100%"}
# Coordinates for Sri Lanka
sri_lanka_coords <- data.frame(
  long = 80.7718,
  lat = 7.8731,
  label = "Sri Lanka"
)

ggplot(worlddata2019, aes(x = long, y = lat, group = group, fill = factor(dengue.present))) +
  geom_polygon(color = "black") +
  geom_point(data = sri_lanka_coords, aes(x = long, y = lat), inherit.aes = FALSE, color = "blue", size = 3) +
  geom_text(data = sri_lanka_coords, aes(x = long, y = lat, label = label), inherit.aes = FALSE,
            vjust = 1, size = 7, color = "blue") +
  coord_fixed(1.3) +
  scale_fill_manual(values = c("#969696", "#fc9272"), name = "Dengue Presence", labels = c("No", "Yes")) +
  labs(
    x = "Longitude",
    y = "Latitude",
    caption = "Author: Thiyanga S. Talagala, Source: https://denguedatahub.netlify.app/world.html"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 12)
  )

```

## Time Series Plot of Weekly Dengue Cases in Sri Lanka (National Level)

```{r, warning=FALSE, message=FALSE, out.width="100%"}
library(dplyr)
library(ggplot2)
library(lubridate)
library(tsibble)
library(tidyverse)
library(lubridate)
library(plotly)
# Step 1: Aggregate weekly cases across all districts
data("srilanka_weekly_data")
srilanka_weekly_data <- srilanka_weekly_data[-which(srilanka_weekly_data$year == 2023 & srilanka_weekly_data$week == 52), ]
country_weekly <- srilanka_weekly_data |>
  group_by(year, week, start.date) %>%
  summarise(total_cases = sum(cases, na.rm = TRUE), .groups = 'drop') |>
  arrange(start.date)

# Step 2: Plot the time series
country_weekly <- country_weekly |> 
  mutate(
         yearweek = yearweek(start.date))

country_weekly_tsibble <- country_weekly |>
  as_tsibble(index = yearweek)
p1 <- ggplot(country_weekly_tsibble, aes(x = yearweek, y = total_cases)) +
  geom_line() +
  scale_x_yearweek(date_breaks = "1 year", date_labels = "%Y") +
  labs(
   # title = "Weekly Dengue Cases in Sri Lanka",
  #  subtitle = "From National Aggregated Data",
    x = "Year",
    y = "Weekly Dengue Cases"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )
ggplotly(p1)
```

## Time Series Plot of Weekly Dengue Cases in Sri Lanka (National Level)

<span style="color: red;">Red Segment: Interrupted Period Due to the COVID-19 Pandemic</span>


```{r}
library(dplyr)
library(ggplot2)
library(tsibble)

# Create highlight flag
country_weekly_tsibble <- country_weekly_tsibble %>%
  mutate(highlight = yearweek >= yearweek("2019 W47") & yearweek <= yearweek("2022 W52"))

# Plot: Two layers to avoid connecting red and grey
ggplot() +
  geom_line(data = country_weekly_tsibble ,
            aes(x = yearweek, y = total_cases),
            color = "black", linewidth = 0.8) +
  geom_line(data = country_weekly_tsibble %>% filter(highlight),
            aes(x = yearweek, y = total_cases),
            color = "red", linewidth = 0.8) +
  scale_x_yearweek(date_breaks = "1 year", date_labels = "%Y") +
  labs(
    x = "Year",
    y = "Weekly Dengue Cases"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )

```